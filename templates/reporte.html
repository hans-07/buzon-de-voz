<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/static/styles/reporte.css">
  <link rel="icon" href="static/img/Tellme.png" type="image/png">
  <title>Reporte - TellMe</title>
</head>
<body>
  <div class="container">
    <!-- Mensajes Flash -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="flash-message flash-{{ 'success' if category == 'success' else 'error' }}">
            {{ message }}
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <div id="mainForm">
      <div class="card">
        <div class="card-header">
          <h1 class="card-title">Enviar Reporte Confidencial</h1>
          <p class="card-description">
            Este sistema está diseñado para proteger su identidad y garantizar una respuesta institucional oportuna.
          </p>
        </div>

        <!-- Selector de tipo de reporte -->
        <div class="report-type-toggle">
          <button type="button" class="toggle-btn active" id="btnIdentificado">
            Reporte Identificado
          </button>
          <button type="button" class="toggle-btn" id="btnAnonimo">
            Reporte Anónimo
          </button>
        </div>

        <form method="POST" id="reportingForm" action="{{ url_for('hacer_reporte') }}">
          <!-- Información personal (solo si es identificado) -->
          <div id="seccionPersonal">
            <div class="form-group">
              <label for="nombre" class="label required-field">Nombre Completo</label>
              <input type="text" id="nombre" name="nombre" class="input" placeholder="Ingrese su nombre completo" required>
            </div>
            <div class="form-group">
              <label for="curso" class="label required-field">Curso</label>
              <input type="text" id="curso" name="curso" class="input" placeholder="Ej: 3° Medio A" required>
            </div>
            <div class="form-group">
              <label for="correo" class="label">Correo Electrónico (opcional)</label>
              <input type="email" id="correo" name="correo" class="input" placeholder="correo@ejemplo.com">
            </div>
          </div>

          <!-- RUT (siempre visible, requerido en ambos modos) -->
          <div class="form-group">
            <label for="rut" class="label required-field">RUT</label>
            <input type="text" id="rut" name="rut" class="input" placeholder="12.345.678-9" required>
            <small class="field-description" id="rutDescription">
              En reportes anónimos, su RUT será tratado con confidencialidad
            </small>
          </div>

          <!-- Tipo de reporte -->
          <div class="form-group">
            <label for="tipoReporte" class="label required-field">Categoría del Incidente</label>
            <select id="tipoReporte" name="tipoReporte" class="select" required>
              <option value="">Seleccione una categoría</option>
              <option value="acoso">Acoso</option>
              <option value="bullying">Bullying</option>
              <option value="discriminacion">Discriminación</option>
              <option value="violencia">Violencia</option>
              <option value="ciberacoso">Ciberacoso</option>
              <option value="conflicto">Conflicto entre estudiantes</option>
              <option value="indisciplina">Indisciplina</option>
              <option value="otro">Otro</option>
            </select>
          </div>

          <!-- Descripción -->
          <div class="form-group">
            <label for="declaracion" class="label required-field">Descripción Detallada</label>
            <textarea 
              id="declaracion" 
              name="declaracion" 
              class="textarea"
              placeholder="Describa con detalle lo ocurrido. Incluya fechas, lugares, personas involucradas y cualquier otro dato relevante."
              required
            ></textarea>
            <div class="character-count" id="charCount">0 caracteres (mínimo 20)</div>
          </div>

          <div class="security-notice">
            <strong>Confidencialidad garantizada:</strong> Toda la información será tratada con estricta reserva y solo será accesible al equipo de convivencia escolar.
          </div>

          <!-- Campo oculto para anónimo -->
          <input type="hidden" name="es_anonimo" id="esAnonimoInput" value="false">

          <!-- Acciones -->
          <div class="button-group">
            <button type="submit" class="btn btn-primary">
              Enviar Reporte
            </button>
          </div>

          <p class="privacy-notice">
            Al enviar este formulario, acepta que la información será procesada de acuerdo a nuestras políticas de privacidad y confidencialidad.
          </p>
        </form>
      </div>
    </div>
  </div>

  <script src="static/js/reporte.js"></script>
</body>
</html>