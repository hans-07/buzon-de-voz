<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/static/styles/detalle_reporte.css">
    <link rel="icon" href="static/img/Tellme.png" type="image/png">
 
  <title>Detalle del Reporte #{{ reporte.id }}</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/lucide.min.css" />
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="detail-header">
      <div>
        <h1>Reporte #{{ reporte.id }}</h1>
        <p>Detalles completos del reporte</p>
      </div>
      <a href="{{ url_for('admin') }}" class="back-link" aria-label="Volver al panel de administración">
        <i data-lucide="arrow-left" size="16"></i> Volver al Panel
      </a>
    </header>

    <!-- Alerta anónimo -->
    {% if reporte.es_anonimo %}
    <div class="anonymous-alert" role="alert" aria-live="polite">
      <i data-lucide="shield" size="18"></i>
      <div>
        <strong>Reporte anónimo:</strong> Este reporte fue enviado de forma anónima para proteger la identidad del estudiante.
      </div>
    </div>
    {% endif %}

    <div class="detail-grid">
      <!-- Columna izquierda -->
      <div>
        <!-- Información del estudiante -->
        <div class="card">
          <div class="card-header">
            <h2><i data-lucide="user" size="18"></i> Información del estudiante</h2>
          </div>
          <div class="card-body">
            <div class="student-info">
              <div class="info-group">
                <div class="info-row">
                  <span class="info-label">Nombre</span>
                  <span class="info-value">{{ reporte.nombre }}</span>
                </div>
                <div class="info-row">
                  <span class="info-label">RUT</span>
                  <span class="info-value">{{ reporte.rut }}</span>
                </div>
                <div class="info-row">
                  <span class="info-label">Fecha</span>
                  <span class="info-value">{{ reporte.created_at.strftime('%d/%m/%Y %H:%M') }}</span>
                </div>
              </div>
              <div class="info-group">
                <div class="info-row">
                  <span class="info-label">Curso</span>
                  <span class="info-value">{{ reporte.curso }}</span>
                </div>
                <div class="info-row">
                  <span class="info-label">Correo</span>
                  <span class="info-value">
                    {% if reporte.correo %}
                      <a href="mailto:{{ reporte.correo }}">{{ reporte.correo }}</a>
                    {% else %}
                      <span class="text-muted">No proporcionado</span>
                    {% endif %}
                  </span>
                </div>
                <div class="info-row">
                  <span class="info-label">Última actualización</span>
                  <span class="info-value">
                    {% if reporte.updated_at and reporte.updated_at != reporte.created_at %}
                      {{ reporte.updated_at.strftime('%d/%m/%Y %H:%M') }}
                    {% else %}
                      Sin actualizaciones
                    {% endif %}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Descripción del incidente -->
        <div class="card mt-4">
          <div class="card-header">
            <h2><i data-lucide="file-text" size="18"></i> Descripción del incidente</h2>
          </div>
          <div class="card-body">
            <div class="mb-3">
              <strong>Categoría:</strong>
              <span class="badge badge-identificado">{{ reporte.categoria|title }}</span>
            </div>
            <div class="incident-description">
              {{ reporte.descripcion }}
            </div>
            <div class="description-meta">
              <i data-lucide="info" size="14"></i>
              {{ reporte.descripcion|length }} caracteres
            </div>
          </div>
        </div>
      </div>

      <!-- Columna derecha -->
      <div>
        <!-- Estado y prioridad -->
        <div class="card">
          <div class="card-header">
            <h2><i data-lucide="activity" size="18"></i> Estado y prioridad</h2>
          </div>
          <div class="status-priority">
            <div class="status-section">
              <h3>Estado actual</h3>
              <span class="badge badge-{{ reporte.estado }}">{{ reporte.estado|title }}</span>
            </div>
            <div class="priority-section">
              <h3>Nivel de prioridad</h3>
              <span class="badge badge-prioridad-{{ reporte.prioridad }}">{{ reporte.prioridad|title }}</span>
            </div>
            {% if reporte.es_anonimo %}
            <div class="mt-3">
              <span class="badge badge-anonimo">
                <i data-lucide="shield" size="14"></i> Reporte anónimo
              </span>
            </div>
            {% endif %}
          </div>
        </div>

        <!-- Acciones -->
        <div class="card mt-4">
          <div class="card-header">
            <h2><i data-lucide="settings" size="18"></i> Acciones</h2>
          </div>
          <div class="card-body">
            <button 
              {% if reporte.estado == 'en_revision' %}disabled{% endif %}
              class="action-btn btn-revision"
              onclick="confirmAction('{{ url_for('cambiar_estado', reporte_id=reporte.id, nuevo_estado='en_revision') }}')"
              aria-label="Marcar reporte como en revisión">
              <i data-lucide="clock" size="16"></i> Marcar en Revisión
            </button>
            
            <button 
              {% if reporte.estado == 'resuelto' %}disabled{% endif %}
              class="action-btn btn-resuelto"
              onclick="confirmAction('{{ url_for('cambiar_estado', reporte_id=reporte.id, nuevo_estado='resuelto') }}')"
              aria-label="Marcar reporte como resuelto">
              <i data-lucide="check" size="16"></i> Marcar como Resuelto
            </button>
            
            <button 
              {% if reporte.estado == 'pendiente' %}disabled{% endif %}
              class="action-btn btn-pendiente"
              onclick="confirmAction('{{ url_for('cambiar_estado', reporte_id=reporte.id, nuevo_estado='pendiente') }}')"
              aria-label="Volver a estado pendiente">
              <i data-lucide="rotate-ccw" size="16"></i> Volver a Pendiente
            </button>
            
            <button class="action-btn btn-print" onclick="window.print()" aria-label="Imprimir reporte">
              <i data-lucide="printer" size="16"></i> Imprimir Reporte
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/lucide@latest"></script>
  <script>
    lucide.createIcons();

    function confirmAction(url) {
      if (confirm('¿Está seguro de que desea cambiar el estado de este reporte?')) {
        window.location.href = url;
      }
    }
  </script>
</body>
</html>