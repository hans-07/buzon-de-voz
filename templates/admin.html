<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title> Administración - Sistema de Reportes</title>
  <link rel="stylesheet" href="/static/styles/admin.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/lucide.min.css" />
  <link rel="icon" href="static/img/logo-complejo.png" type="image/png">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="admin-header">
      <div>
        <h1>Panel de Administración</h1>
        <p>Sistema de Gestión de Reportes Escolares</p>
      </div>
      <a href="{{ url_for('logout') }}" class="logout-btn" aria-label="Cerrar sesión">
        <i data-lucide="log-out" size="16"></i> Cerrar Sesión
      </a>
    </header>

    <!-- Estadísticas -->
    <div class="stats-grid">
      <div class="stat-card">
        <p class="stat-value">{{ reportes|length }}</p>
        <p class="stat-label">Total Reportes</p>
      </div>
      <div class="stat-card">
        <p class="stat-value">{{ reportes|selectattr('estado', 'equalto', 'pendiente')|list|length }}</p>
        <p class="stat-label">Pendientes</p>
      </div>
      <div class="stat-card">
        <p class="stat-value">{{ reportes|selectattr('prioridad', 'equalto', 'alta')|list|length }}</p>
        <p class="stat-label">Alta Prioridad</p>
      </div>
      <div class="stat-card">
        <p class="stat-value">{{ reportes|selectattr('es_anonimo', 'equalto', true)|list|length }}</p>
        <p class="stat-label">Anónimos</p>
      </div>
    </div>

    <!-- Tabla -->
    <div class="report-table-card">
      <div class="table-header">
        <h2><i data-lucide="file-text" size="20"></i> Lista de Reportes</h2>
      </div>
      {% if reportes %}
      <div class="table-responsive">
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Tipo</th>
              <th>Nombre</th>
              <th>RUT</th>
              <th>Curso</th>
              <th>Categoría</th>
              <th>Prioridad</th>
              <th>Estado</th>
              <th>Fecha</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            {% for reporte in reportes %}
            <tr>
              <td>{{ reporte.id }}</td>
              <td>
                {% if reporte.es_anonimo %}
                  <span class="badge badge-anonimo" aria-label="Reporte anónimo">
                    <i data-lucide="shield" size="12"></i> Anónimo
                  </span>
                {% else %}
                  <span class="badge badge-identificado" aria-label="Reporte identificado">
                    <i data-lucide="user" size="12"></i> Identificado
                  </span>
                {% endif %}
              </td>
              <td>{{ reporte.nombre }}</td>
              <td>{{ reporte.rut }}</td>
              <td>{{ reporte.curso }}</td>
              <td><span class="badge badge-identificado">{{ reporte.categoria|title }}</span></td>
              <td>
                <span class="badge badge-prioridad-{{ reporte.prioridad }}">
                  {{ reporte.prioridad|title }}
                </span>
              </td>
              <td>
                <span class="badge badge-{{ reporte.estado }}">
                  {{ reporte.estado|title }}
                </span>
              </td>
              <td>{{ reporte.created_at.strftime('%d/%m/%Y %H:%M') }}</td>
              <td>
                <a href="{{ url_for('detalle_reporte', reporte_id=reporte.id) }}" class="action-btn" title="Ver detalles" aria-label="Ver detalles del reporte {{ reporte.id }}">
                  <i data-lucide="eye" size="16"></i>
                </a>
                {% if reporte.estado == 'pendiente' %}
                <a href="{{ url_for('cambiar_estado', reporte_id=reporte.id, nuevo_estado='resuelto') }}" class="action-btn" title="Marcar como resuelto" aria-label="Marcar reporte {{ reporte.id }} como resuelto">
                  <i data-lucide="check" size="16"></i>
                </a>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <div class="empty-state">
        <i data-lucide="inbox" size="64"></i>
        <h3>No hay reportes registrados</h3>
        <p>Los nuevos reportes aparecerán aquí automáticamente.</p>
      </div>
      {% endif %}
    </div>
  </div>

  <script src="https://unpkg.com/lucide@latest"></script>
  <script>lucide.createIcons();</script>
</body>
</html>